<!DOCTYPE html>
<html>
<head>
    <title>BasketBall Game</title>
    <script src="/socket.io/socket.io.js"></script>

    <style>
        body {
            background-color: black;
            overflow: hidden;
        }

        img {
            height: 1px;
            width: 1px;
            visibility: hidden;
        }
    </style>
</head>
<body>
    <canvas height="500" width="1000" id="paper"></canvas>
    <img id="net" src="https://idougherty.github.io/basketball/net.png"></img>
    <script>

window.onload = function() {
    var canvas = document.getElementById("paper");
    var c = canvas.getContext("2d");
    
    var player = null;
    
    var socket = io.connect();
    
    socket.on('player connected', function(data){
        if(player === null) {
            player = data;
            console.log(player);
        }
    });
    
    socket.on("draw", function(data) {
        
        c.fillStyle = "rgba(255, 255, 255, 1)";
        c.fillRect(0, 0, canvas.width, canvas.height);
        
        c.font = "300px Impact";
        c.fillStyle = "#ddd";
        c.textAlign = "center";
        c.fillText(data.player1.score, 300, 360);
        c.fillText(data.player2.score, canvas.width - 300, 360);
        
        c.fillRect(0, canvas.height - 20, canvas.width, 20);
        
        c.fillStyle = "#ddd";
        c.fillRect(0, 0, 20, canvas.height);
        c.fillRect(canvas.width - 20, 0, 20, canvas.height);
        
        c.fillStyle = data.player1.color;//"rgba(50, 255, 255, 1)";
        c.fillRect(data.player1.x, data.player1.y, data.player1.width, data.player1.height);
        c.fillStyle = "rgba(25, 125, 175, 1)";
        c.fillRect(data.player1.x + 10, data.player1.y + 10, data.player1.width - 20, data.player1.charge * 3);
        
        c.fillStyle = data.player2.color;//"rgba(255, 50, 50, 1)";
        c.fillRect(data.player2.x, data.player2.y, data.player2.width, data.player2.height);
        c.fillStyle = "rgba(175, 25, 25, 1)";
        c.fillRect(data.player2.x + 10, data.player2.y + 10, data.player2.width - 20, data.player2.charge * 3);
        
        
        c.fillStyle = "rgba(250, 130, 55, 1)";
        
        if(data.ball.y + data.ball.width < 0) {
            c.beginPath();
            c.moveTo(data.ball.x + data.ball.width/2, 15);
            c.lineTo(data.ball.x, 35);
            c.lineTo(data.ball.x + data.ball.width, 35);
            c.lineTo(data.ball.x + data.ball.width/2, 15);
            c.lineTo(data.ball.x, 35);
            
            c.fillStyle = "#ee3";
            c.strokeStyle = "#777";
            c.lineWidth = 10;
            c.stroke();
            c.fill();
        }
        
        c.fillRect(data.ball.x, data.ball.y, data.ball.width, data.ball.height);
        
        c.drawImage(document.getElementById("net"), 20, 150, 80, 80);
        c.drawImage(document.getElementById("net"), 900, 150, 80, 80);
        
    });
    
    
    document.addEventListener("keydown", function(e) {
        socket.emit('keydown ' + player, e.which);
    });
    
    document.addEventListener("keyup", function(e) {
        socket.emit('keyup ' + player, e.which);
    });
};
    </script>
</body>
</html>